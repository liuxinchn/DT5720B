# 720 DPP-PSD Register Description and Data Format



## Purpose of this Manual

用户手册包含720家族系列的DPP-PSD固件寄存器的完整描述。符合DPP-PSD固件版本4.17 _131.11。



## Symbols, abbreviated terms and notation 

ADC     				
AMC 					
DAQ 				
DAC 
DC 
DPP 
DPP-QDC 
DPP-PHA 
DPP-PSD 
LVDS 
ROC 
USB 



## Registers and Data Format

用户手册中描述的所有寄存器都是32位宽的。在vme访问的情况下，可以使用A24和A32寻址模式。



### Register Address Map

下表报告了用户可以访问的寄存器的完整列表。可以单击第一列中的寄存器名称，将其重定向到相关的寄存器描述。寄存器地址在第二列中以十六进制值的形式报告。第三列表示允许的寄存器访问模式

- I : Individual register。这种寄存器有N个实例，其中N是板中通道的总数。单个寄存器可以以单一模式(单个设置)或广播(对所有通道的同时写访问)写入。读命令必须是个别的。单次访问可以在地址0xlnXY执行，其中n是通道号，而广播写可以在地址0x80XY执行
- C: common Register。具有此属性的寄存器只有一个实例，因此只能在地址0x80XY上执行读和写访问。



### Short Gate Width 

为脉冲形状鉴别中快速元件的电荷积分设置短栅宽度.



### Long Gate Width

为脉冲形状鉴别中慢速元件的电荷积分设置长栅宽度。用长积分门进行能谱计算



### Gate Offset 

为了正确地集成输入脉冲，集成门在触发器位置之前启动。Gate Offset定义了Gate在触发器之前启动多少个样本。



### Trigger Threshold 

设置前沿识别的触发阈值



### Fixed Baseline

基线计算可以动态或静态地执行。在第一种情况下，用户可以通过寄存器0xln80设置移动平均窗口的样本。在后一种情况下，用户必须禁用通过寄存器0xln80的比特[22:20]自动基线计算，并通过该寄存器设置所需的附加基线值。基线值在整个采集过程中保持不变。



### Trigger Latency

该寄存器允许用户设置一个时间窗口(延迟)，添加到形状触发器宽度(即相关窗口的长度)中，当设置数字化器通道之间的重合/反重合时，需要考虑从背带到主板的触发器传播中的延迟。



### Shaped Trigger Width 

形状触发器是一个可编程宽度的逻辑信号，由通道生成，对应于其本地自触发器(即前缘鉴别器的输出)。它用于将触发器传播到板的其他通道和其他外部板，以及提供符合触发器逻辑。



### Threshold for the PSD cut 

设置PSD阈值，根据事件的PSD值在线选择事件。PSD范围为0到1。



### PUR-GAP Threshold 

当同一门内出现“峰-谷-峰”情况时，检测到堆积事件。谷和峰之间的间隙可以通过这个寄存器来编程。更多细节请参考CoMPASS用户手册。



### DPP Algorithm Control 

管理DPP算法的特点。

**从0~31字节，各自有不同过的功能。**



### Channel n Status

该寄存器包含通道n的状态信息。



### AMC Firmware Revision 

返回固件的版本



### DC Offset 

该寄存器允许调整ADC刻度上输入信号的基线位置(即0伏)。ADC的规模范围从0到  2<sup>NBit</sup>  -1，其中NBit是板载ADC的位数。控制直流偏移量的DAC有16位，即它从0到65535独立于NBit值和单板类型。

通常DC Offset值为32K (DAC中等刻度)对应ADC中等刻度。直流偏移量的增大使基线减小。DAC的范围大约比ADC的范围大5%(典型)，因此接近O和64K的DAC设置分别对应ADC的超出和低于范围。

警告:在写入此寄存器之前，必须检查Oxln88位[2]= 0，否则写入进程将无法正常运行!



### Board Configuration

该寄存器包含单板配置的一般设置。

**从0~31字节，各自有不同过的功能。**



### Aggregate Organization 总组织

数字化器的内部存储器可以划分为可编程数量的聚合，其中每个聚合包含特定数量的事件。这个寄存器定义了内存中可以包含多少个聚合。

注意：在采集过程中，这个寄存器不能被修改。



### Record Length 

设置波形采集的记录长度 



### Number of Events per Aggregate 每个聚合的事件数

每个通道都有固定数量的RAM内存来保存事件。内存被划分为可编程数量的缓冲区，称为“聚合”，其事件数量可以通过这个寄存器编程。



### Pre Trigger 

预触发器定义了保存到内存中的波形中触发器之前的采样数量。



### Trigger Hold-Off Width 触发延迟宽度

触发延迟是一种可编程宽度的逻辑信号，由信道产生，与它的本地自触发相对应。其他触发器在整个触发器暂停持续时间内被抑制



### Acquisition Control 

该寄存器管理采集设置。

**从0~31字节，各自有不同过的功能。**



### Acquisition Status 

该寄存器监视与获取状态相关的一组条件。

**从0~31字节，各自有不同过的功能。**



### Software Trigger 

写入这个寄存器会生成一个软件触发器，该触发器被传播到板上所有启用的通道。



### Global Trigger Mask 

该寄存器设置哪些信号可用于生成全局触发器。

**从0~31字节，各自有不同过的功能。**



### Front Panel TRG-OUT (GPO) Enable Mask 

这个寄存器设置了哪些信号可以在前面板TRG-OUT LEMO连接器上产生信号(在DT和NIM板情况下为GPO)。

**从0~31字节，各自有不同过的功能。**



### Front Panel I/O Control 

这个寄存器管理前面板I/O连接器。缺省值为0x000000。

**从0~31字节，各自有不同过的功能。**



### Channel Enable Mask

该寄存器启用/禁用所选通道参与事件读取。禁用的通道不可用。

警告:此寄存器不能在采集运行时被修改。



### ROC FPGA Firmware Revision 

该寄存器包含主板FPGA (ROC)固件修订信息。



### Voltage Level Mode Configuration 

当电压水平模式被启用(位[2:0]= 100 (bin)的寄存器0x8144)，该寄存器设置DAC值提供在前面板MON/Sigma输出LEMO连接器:1 LSB = 0.244 mV，终止在50欧姆。

注意:此寄存器仅由VME板支持。



### Software Clock Sync 

上电时，固件向adc发出Sync命令，使所有adc与板上时钟同步。在标准操作中，该命令不需要用户重复执行。

对该寄存器的写访问(任意值)迫使锁相环重新将所有时钟输出与参考时钟对齐。

示例:在VME板之间分布菊花链时钟的情况下，在初始化和配置过程中，菊花链上的参考时钟可能不稳定，锁相环中可能出现暂时的失锁;尽管一旦参考时钟恢复稳定，锁就会自动恢复，但不能保证相移返回到已知状态。该命令允许单板恢复CLK-IN和内部时钟之间的正确相移。

注意:此寄存器仅由VME板支持。

注意:该命令必须从时钟链的第一个板到最后一个板开始下发。



### Board Info 

该寄存器包含电路板的特定信息，如数字化器系列、通道内存大小和通道密度。



### Analog Monitor Mode 

该寄存器选择在MON/Sigma前面板LEMO连接器上提供哪种输出模式。

注意:此寄存器仅由VME板支持。



### Event Size 

该寄存器包含当前事件大小，用32位字表示。该值在每个事件完全读出后更新。



### Time Bomb Downcounter 倒计时

这是一个向下的计数器值。如果为固定值，则启用固件license，可以不受时间限制地使用当前的固件。如果该值随时间递减，则模块上电30分钟后固件将停止工作(无法进入RUN模式)。如果该值为0，表示该时间炸弹已过期，在不上电的情况下，不允许模块以RUN模式进入。



### Fan Speed Control 

该寄存器管理板上风扇转速，以保证根据内部温度变化进行适当的冷却。

注意:从主板PCB的修订版4(参见配置ROM的寄存器0xF04C)，自动风扇速度控制已经实现，并由大于4.4的ROC FPGA固件修订版支持(参见寄存器0x8124)。

独立的修订，用户可以设置位[3]= 1风扇转速高。设置位[3]= 0将恢复自动控制的修订版4或更高，或低风扇转速的情况下修订版4。

注意:此寄存器仅由桌面(DT)板支持。